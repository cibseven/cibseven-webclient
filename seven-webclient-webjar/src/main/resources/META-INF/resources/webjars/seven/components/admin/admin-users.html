<div class="d-flex flex-column bg-light" :style="{ height: 'calc(100% - 55px)' }">
	<div class="container pt-4">
		<div class="row align-items-center pb-2">		
			<div class="col-4">
			 	<b-input-group size="sm">
				    <template #prepend>
			      		<b-button :title="$t('searches.search')" aria-hidden="true" class="rounded-left" variant="secondary"><span class="mdi mdi-magnify" style="line-height: initial"></span></b-button>
				    </template>
				    <b-form-input :title="$t('searches.search')" :placeholder="$t('searches.search')" @keyup="searchUsers" v-model="filter"></b-form-input>
  				</b-input-group>
			 </div>
			 <div class="col-8 text-end">
			 	<b-button class="border" size="sm" variant="light" v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'" @click="add()">
					<span class="mdi mdi-plus"> {{ $t('admin.users.add') }} </span>
				</b-button>
				<b-button v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'" class="border" size="sm" variant="light" 
					:disabled="exporting" @click="exportCSV()">
					<span v-if="exporting"><b-spinner small></b-spinner> {{ $t('admin.exportCsv') }}</span>
					<span v-else class="mdi mdi-download"> {{ $t('admin.exportCsv') }} </span>
				</b-button>
			 </div>
	 	</div>
	</div>	 
	<div class="container overflow-auto bg-white shadow" @scroll="showMore">
		<flow-table striped v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'" thead-class="sticky-header" :items="users" primary-key="id"
		 	prefix="admin.users." :fields="[{label: 'id', key: 'id', class: 'col-md-2 col-sm-2', tdClass: 'border-end py-1' },
					{label: 'firstName', key: 'firstName', class: 'col-md-3 col-sm-3', tdClass: 'border-end py-1' },
					{label: 'lastName', key: 'lastName', class: 'col-md-2 col-sm-2', tdClass: 'border-end py-1' },
					{label: 'email', key: 'email', class: 'col-md-3 col-sm-3', tdClass: 'border-end  py-1' },
					{label: 'actions', key: 'actions', class: 'col-md-2 col-sm-2', sortable: false, thClass: 'justify-content-center', tdClass: 'justify-content-center py-0' }]"
			@contextmenu="focused = $event" @mouseenter="focused = $event" @mouseleave="focused = null">
			<template v-slot:cell(actions)="row">
   				<div>
					<b-button :disabled="focused !== row.item" style="opacity: 1" @click="edit(row.item)" class="px-2 border-0 shadow-none" :title="$t('admin.users.editUser')" variant="link">
						<span class="mdi mdi-18px mdi-pencil-outline"></span>
					</b-button>
					<span class="border-start h-50" :class="focused === row.item ? 'border-secondary' : ''"></span>
					<b-button :disabled="focused !== row.item" style="opacity: 1" @click="prepareRemove(row.item)" class="px-2 border-0 shadow-none" :title="$t('admin.users.deleteUser')" variant="link">
						<span class="mdi mdi-18px mdi-delete-outline"></span>
					</b-button>
   				</div>
               </template>				
		</flow-table>
		<flow-table v-else striped :items="users" primary-key="id" table-class="table-striped"
		 	prefix="admin.users." :fields="[{label: 'id', key: 'id', class: 'col-md-3 col-sm-3'},
					{label: 'firstName', key: 'firstName', class: 'col-md-3 col-sm-3'},
					{label: 'lastName', key: 'lastName', class: 'col-md-3 col-sm-3'},
					{label: 'email', key: 'email', class: 'col-md-3 col-sm-3'}]"
			@contextmenu="focused = $event" @mouseenter="focused = $event" @mouseleave="focused = null">
		</flow-table>
		<div class="mb-3 text-center w-100" v-if="loading">
			<loader class="d-inline me-2" styling="width: 35px"></loader> {{ $t('admin.loading') }}
		</div>
		<div class="mb-3 text-center w-100" v-if="!loading && users.length === 0">
			{{ $t('admin.noResults') }}
		</div>
 	</div>
	
	<b-modal ref="deleteModal" :title="$t('confirm.title')">
		<div class="container-fluid">
			<div class="row align-items-center">
				<div class="col-2">
					<span class="mdi-36px mdi mdi-alert-outline text-warning me-3"></span>
				</div>	
				<div class="col-10">
					<span v-if="userSelected">
						<p>{{ $t('admin.users.confirmDelete') }}</p>
						<strong>{{ $t('admin.users.userId') }}:</strong> {{ userSelected.id }} <br>
						<strong>{{ $t('admin.users.firstName') }}:</strong> {{ userSelected.firstName }}<br>
						<strong>{{ $t('admin.users.lastName') }}:</strong> {{ userSelected.lastName }}<br>
						<strong>{{ $t('admin.users.email') }}:</strong> {{ userSelected.email }}
					</span>
				</div>			
			</div>
		</div>
		<template v-slot:modal-footer>
			<b-button v-t="'confirm.ok'" variant="primary" @click="remove(userSelected); $refs.deleteModal.hide()"></b-button>
			<b-button v-t="'confirm.cancel'" @click="$refs.deleteModal.hide()"></b-button>
		</template>
	</b-modal>
	<task-popper ref="importPopper"></task-popper>
</div>
