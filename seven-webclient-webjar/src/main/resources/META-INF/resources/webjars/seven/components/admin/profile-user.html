<sidebars ref="sidebars" header-margin="55px" v-model:left-open="leftOpen" 
	:left-caption="$t('admin.users.title') + ' - ' + user.id" :left-size="[12, 6, 4, 3, 2]">
	<template v-slot:left>
		<b-list-group>
			<b-list-group-item class="border-0 px-3 py-2" :active="$route.query.tab === 'profile'" exact :to="'?tab=profile'">
				<span> {{ $t('admin.users.profile') }}</span>
			</b-list-group-item>
			<b-list-group-item v-if="!readOnlyUser" class="border-0 px-3 py-2" :active="$route.query.tab === 'account'" exact :to="'?tab=account'">
				<span> {{ $t('admin.users.account') }}</span>
			</b-list-group-item>
			<b-list-group-item class="border-0 px-3 py-2" :active="$route.query.tab === 'groups'" exact :to="'?tab=groups'">
				<span> {{ $t('admin.users.groups') }}</span>
			</b-list-group-item>
			<b-list-group-item v-if="$root.user && $root.user.id === user.id && $root.config.notifications.tasks.enabled" class="border-0 px-3 py-2" 
				:active="$route.query.tab === 'preferences'" exact :to="'?tab=preferences'">
				<span> {{ $t('admin.users.preferences.title') }}</span>
			</b-list-group-item>		
		</b-list-group>
	</template>
											
	<transition name="slide-in" mode="out-in">
		<div class="d-flex flex-column bg-light w-100 h-100" v-if="user.id">
			<b-button v-if="editMode" variant="light" style="min-height: 35px; line-height: 20px;" :block="true" class="rounded-0 border-bottom text-start" href="#/seven/auth/admin/users">
		   		<span class="mdi mdi-arrow-left me-2 float-left"></span>
		   			{{ $t('admin.users.title') }}   	
   			</b-button>
			<div class="container-fluid overflow-auto">
				<div v-if="$route.query.tab === 'profile'" class="row">
					<div class="col-sm-12 col-md-12 col-lg-8 col-xl-6 p-4">
						<b-card class="border-0 p-5 shadow" :title="$t('admin.users.editMessage', [user.firstName + ' ' + user.lastName])">
							<b-card-text class="border-top border-top pt-4 mt-3">
								<cib-form @submitted="update()">								
									<b-form-group :label="$t('admin.users.firstName') + '*'" label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4"
										:invalid-feedback="$t('errors.invalid')">
										<b-form-input v-model="user.firstName" @update="dirty=true"
											:state="notEmpty(user.firstName)" :readonly="readOnlyUser || !editMode" required></b-form-input>
									</b-form-group>						
									<b-form-group :label="$t('admin.users.lastName') + '*'" label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4"
										:invalid-feedback="$t('errors.invalid')">
										<b-form-input v-model="user.lastName" @update="dirty=true"
											:state="notEmpty(user.lastName)" :readonly="readOnlyUser || !editMode" required></b-form-input>
									</b-form-group>
									<b-form-group :label="$t('admin.users.email')" label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4"
										:invalid-feedback="$t('errors.invalid')">
										<b-form-input v-model="user.email" type="email" autocomplete="email" @update="dirty = true" :readonly="readOnlyUser || !editMode"></b-form-input>
									</b-form-group>
									<div class="float-end" v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'">
										<b-button type="submit" variant="secondary" :disabled="!dirty" >{{ $t('admin.users.update') }}</b-button>
									</div>
								</cib-form>
							</b-card-text>
						</b-card>
					 </div>
			 	</div>
				<div v-if="$route.query.tab === 'account' && !readOnlyUser" class="row">
					<div class="col-sm-12 col-md-12 col-lg-8 col-xl-6 p-4">
						<b-card class="border-0 p-5 shadow" :title="$t('admin.users.editMessage', [user.firstName + ' ' + user.lastName])">
							<h6 class="mt-4">{{ $t('password.recover.changePassword') }}</h6>
							<b-form-group labels-cols-lg="2" label-size="lg" label-class="font-weight-bold pt-0 pb-4" class="m-0">
								<b-form-group :label="$t('password.recover.id') + '*'" label-cols-sm="2" 
									label-align-sm="left" label-class="pb-4" :invalid-feedback="$t('errors.invalid')">
									<b-form-input v-model="user.id" :state="notEmpty(user.id)" required readonly></b-form-input>
								</b-form-group>
								<div class="float-end d-flex align-items-center">
									<b-spinner variant="primary" class="mx-2" v-if="sendingEmail"></b-spinner>								
									<b-button type="submit" variant="secondary" :disabled="sendingEmail" @click="onSendEmail()">{{ $t('password.recover.sendEmail') }}</b-button>
								</div>						
							</b-form-group>
							<!-- 
							<b-form @submit="changePassword($event)">
								<b-card-text class="border-top border-top pt-4 mt-3">
									<b-form-group :label="$t('admin.users.currentUserPassword') + '*'"
										label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4">
										<b-input-group>
										    <b-form-input :type="passwordVisibility.current ? 'text' : 'password'" v-model="credentials.authenticatedUserPassword" 
										    	:state="notEmpty(credentials.authenticatedUserPassword)" required></b-form-input>
										    <b-input-group-append>
									      		<b-button variant="link" class="px-2 border border-start-0" @click="passwordVisibility.current = !passwordVisibility.current">
									      			<span class="mdi mdi-18px" style="line-height: 0" :class="passwordVisibility.current ? 'mdi-eye-off-outline' : 'mdi-eye-outline'"></span>
								      			</b-button>
										    </b-input-group-append>
									  	</b-input-group>
									</b-form-group>
									
									<b-form-group :label="$t('admin.users.newPassword') + '*'" label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4">
										<template v-slot:label>
											{{ $t('admin.users.newPassword') + '*' }}
											<span v-if="$root.config.admin.passwordPolicyEnabled" ref="passwordHelper" style="cursor: pointer" class="mdi mdi-help-circle" :class="passwordPolicyError ? 'text-danger' : 'text-secondary'"></span>
										</template>
										<b-input-group>
											<b-form-input :type="passwordVisibility.new ? 'text' : 'password'" v-model="credentials.password" 
												:state="notEmpty(credentials.password) && !passwordPolicyError" required></b-form-input>
											<b-input-group-append>
									      		<b-button variant="link" class="px-2 border border-start-0" @click="passwordVisibility.new = !passwordVisibility.new">
									      			<span class="mdi mdi-18px" style="line-height: 0" :class="passwordVisibility.new ? 'mdi-eye-off-outline' : 'mdi-eye-outline'"></span>
								      			</b-button>
										    </b-input-group-append>
											<div v-if="passwordPolicyError" class="invalid-feedback">{{ $t('errors.PasswordPolicyException') }}</div>
										</b-input-group>
									</b-form-group>				
									
									<b-form-group :label="$t('admin.users.newPasswordRepeat') + '*'" label-cols-sm="6" label-cols-md="6" label-cols-lg="4" label-align-sm="left" label-class="pb-4"
										:invalid-feedback="$t('errors.passwordDoNotMatch')">
										<b-input-group>
											<b-form-input :type="passwordVisibility.repeat ? 'text' : 'password'" v-model="passwordRepeat" :state="same(credentials.password, passwordRepeat)" required></b-form-input>
											<b-input-group-append>
									      		<b-button variant="link" class="px-2 border border-start-0" @click="passwordVisibility.repeat = !passwordVisibility.repeat">
									      			<span class="mdi mdi-18px" style="line-height: 0" :class="passwordVisibility.repeat ? 'mdi-eye-off-outline' : 'mdi-eye-outline'"></span>
								      			</b-button>
										    </b-input-group-append>
									    </b-input-group>
									</b-form-group>
									
									<div class="float-right" v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'">
										<b-button type="submit" variant="secondary">{{ $t('admin.users.changePassword') }}</b-button>
									</div>
									
									<div class="float-left" v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider' && editMode">
										<b-button variant="warning" @click="$refs.deleteModal.show()">{{ $t('admin.users.deleteUser') }}</b-button>
									</div>
								</b-card-text>
							</b-form>
							-->
						</b-card>
					</div>
			 	</div>
				<div v-if="$route.query.tab === 'groups'" class="row">
					<div class="col-12">
						<b-card class="border-0 bg-light">
							<b-form-group labels-cols-lg="2" label-size="lg" label-class="font-weight-bold pt-0" 
								:label="$t('admin.users.editMessage', [user.firstName + ' ' + user.lastName])">
							</b-form-group>
							<div class="row pt-3">
								<div class="col-9">
									<h5>{{ $t('admin.users.group.title', [user.firstName + ' ' + user.lastName]) }}</h5>
								</div>
								<div v-if="editMode" class="col-3 pb-3">
									<div class="float-end">										
									 	<b-button class="border" size="sm" variant="light" v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider'" @click="openAssignGroupModal">
											<span class="mdi mdi-plus"> {{ $t('admin.users.group.add') }} </span>
										</b-button>
									</div>
								</div>
					 		</div>
							<div v-if="groups" class="container-fluid overflow-auto bg-white shadow">		
								<flow-table v-if="$root.config.userProvider === 'de.cib.cibflow.auth.CamundaUserProvider' && editMode" striped :items="groups" primary-key="id"
									prefix="admin.groups." :fields="[{label: 'id', key: 'id', class: 'col-md-4 col-sm-4', tdClass: 'border-end py-1' },
											{label: 'name', key: 'name', class: 'col-md-4 col-sm-4', tdClass: 'border-end py-1' },
											{label: 'type', key: 'type', class: 'col-md-2 col-sm-2', tdClass: 'border-end py-1' },
											{label: 'actions', key: 'actions', class: 'col-md-2 col-sm-2', sortable: false, thClass: 'justify-content-center', tdClass: 'justify-content-center py-0' }]"
									@contextmenu="focusedGroup = $event" @mouseenter="focusedGroup = $event" @mouseleave="focusedGroup = null">
									<template v-slot:cell(actions)="row">
					    				<div>
						    				<b-button :disabled="focusedGroup !== row.item" style="opacity: 1" @click="unassignGroup(row.item)" class="px-2 border-0 shadow-none" variant="link">
												<span class="mdi mdi-18px mdi-delete-outline"></span>
											</b-button>
					    				</div>
				                   	</template>				
								</flow-table>									
								<flow-table v-else :items="groups" primary-key="id" striped
								 	prefix="admin.groups." :fields="[{label: 'id', key: 'id', class: 'col-md-4 col-sm-4'},
											{label: 'name', key: 'name', class: 'col-md-4 col-sm-4'},
											{label: 'type', key: 'type', class: 'col-md-4 col-sm-4'}]"
									@contextmenu="focusedGroup = $event" @mouseenter="focusedGroup = $event" @mouseleave="focusedGroup = null">
								</flow-table>
						 	</div>							 		
						</b-card>
					</div>		
				</div>
				<div v-if="$route.query.tab === 'preferences'" class="row">
					<div class="col-sm-12 col-md-12 col-lg-8 col-xl-6 p-4">
						<b-card class="border-0 p-5 shadow" :title="$t('admin.users.editMessage', [user.firstName + ' ' + user.lastName])">
							<b-card-text class="border-top border-top pt-4 mt-3">
								<b-form-group>
									<b-form-checkbox v-model="tasksCheckNotificationsDisabled">
								   		{{ $t('admin.users.preferences.notifications') }}
								    </b-form-checkbox>
								</b-form-group>						
							</b-card-text>
						</b-card>
					 </div>
			 	</div>
			</div>
			<!-- Assign Groups Modal -->
			<b-modal v-if="editMode" ref="assignGroupsModal" :title="$t('admin.users.group.add')" size="lg">
				<div v-if="unAssignedGroups.length > 0" class="container">
					<flow-table :items="unAssignedGroups" primary-key="id" prefix="admin.groups." striped
						:fields="[{ label: '', key: 'selected', class: 'col-sm-1', sortable: false, thClass: 'text-center, border-top-0', tdClass: 'text-center' },
						{ label: 'id', key: 'id', class: 'col-sm-3', thClass: 'border-top-0' },
						{ label: 'name', key: 'name', class: 'col-sm-5', thClass: 'border-top-0' },
						{ label: 'type', key: 'type', class: 'col-sm-3', thClass: 'border-top-0' }]">
						<template v-slot:cell(selected)="row">
							 <b-form-checkbox v-model="row.item.selected"></b-form-checkbox>
		                </template>		
					</flow-table>
				</div>
				<div v-else>
					{{ $t('admin.users.group.noResults') }}
				</div>
				<template v-slot:modal-footer>
					<b-button v-t="'confirm.ok'" variant="primary" 
						@click="assignGroups(); $refs.assignGroupsModal.hide()"></b-button>				
					<b-button v-t="'confirm.cancel'" @click="$refs.assignGroupsModal.hide()"></b-button>
				</template>
			</b-modal>
			<b-modal v-if="editMode" ref="deleteModal" :title="$t('confirm.title')">
				<div class="container-fluid">
					<div class="row align-items-center">
						<div class="col-2">
							<span class="mdi-36px mdi mdi-alert-outline text-warning me-3"></span>
						</div>	
						<div class="col-10">
							<p>{{ $t('admin.users.confirmDelete') }}</p>
							<strong>{{ $t('admin.users.userId') }}:</strong> {{ user.id }} <br>
							<strong>{{ $t('admin.users.firstName') }}:</strong> {{ user.firstName }}<br>
							<strong>{{ $t('admin.users.lastName') }}:</strong> {{ user.lastName }}<br>
							<strong>{{ $t('admin.users.email') }}:</strong> {{ user.email }}
						</div>			
					</div>
				</div>
				<template v-slot:modal-footer>
					<b-button v-t="'confirm.ok'" variant="primary" 
						@click="deleteUser(); $refs.deleteModal.hide()"></b-button>				
					<b-button v-t="'confirm.cancel'" @click="$refs.deleteModal.hide()"></b-button>
				</template>
			</b-modal>
		</div>
	</transition>
	<b-popover :target="() => $refs.passwordHelper" triggers="hover">
		<h6>{{ $t('password.policy.title') }}</h6>
		<div>{{ $t('password.policy.header') }}</div>
		<ul>
			<li v-for="item in $t('password.policy.items')">{{ item }}</li>
		</ul>
  	</b-popover>
  	<success ref="emailSent"> {{ $t('password.recover.emailSent') }} </success>
	<success ref="updateProfile" top="0" style="z-index: 1031">{{ $t('admin.users.updateProfileMessage', [user.id]) }}</success>
	<success ref="updatePassword" top="0" style="z-index: 1031">{{ $t('admin.users.updatePasswordMessage', [user.id]) }}</success>
	<success ref="deleteUser" top="0" style="z-index: 1031">{{ $t('admin.users.userDeletedMessage', [user.id]) }}</success>
	<success ref="unassignGroup" top="0" style="z-index: 1031">{{ $t('admin.users.unassignGroupMessage', [user.id],) }}</success>
</sidebars>
