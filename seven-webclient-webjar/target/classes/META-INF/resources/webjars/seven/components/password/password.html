<div class="container-fluid">
	<div v-if="tokenValidated" class="row h-100 align-items-center">
		
		<div class="bg-light h-100 d-none d-md-block col-md-5 p-5">
			<img class="h-100 w-100" :src="$root.resetPasswordImgPath">
		</div>
		
		<div class="d-flex flex-column col-md-7 justify-content-center align-items-center">
			<div class="justify-content-center p-4">
				<h1 class="text-dark text-center">{{ $t('login.productName') }}</h1>
				<h3 class="text-secondary text-center">{{ $t('login.productSlogan') }}</h3>
			</div>
			
			<h4 class="text-center p-2">{{ $t('password.recover.title') }}</h4>
			
			<b-form @submit.prevent="onChangePassword()" class="d-flex flex-column w-50">
				<b-form-group label-class="pb-2" class="position-relative">
					<template v-slot:label>{{ $t('admin.users.password') + '*' }}</template>
					
					<b-form-input :type="fieldType(showPassword)" ref="pass"
						label-cols-sm="2" v-model="credentials.password"
						:state="notEmpty(credentials.password) && !passwordPolicyError"
						required>
					</b-form-input>
					
					<div v-if="$root.config.admin.passwordPolicyEnabled"
						class="text-secondary mdi-alert-circle-outline py-1 px-2 mdi mdi-18px position-absolute"
						ref="passwordHelper" role="button" style="top: 0px; right: -60px"></div>
						
					<div class="position-absolute text-secondary py-1 px-2 mdi mdi-18px"
						:class="{ 'mdi-eye-outline': !showPassword, 'mdi-eye-off-outline': showPassword }"
						@click="showPassword = !showPassword" role="button"
						style="top: 0px; right: -30px"></div>
						
					<div v-if="passwordPolicyError" class="invalid-feedback">{{
						$t('errors.PasswordPolicyException') }}
					</div>
					
				</b-form-group> 
			
				<b-form-group :label="$t('admin.users.passwordRepeat') + '*'"
					class="position-relative" label-class="pb-2"
					:invalid-feedback="$t('errors.passwordDoNotMatch')">
					
					<b-form-input :type="fieldType(showPassRepeat)" ref="passRepeat"
						label-cols-sm="2" v-model="passwordRepeat"
						:state="same(credentials.password, passwordRepeat)" required>
					</b-form-input>
					
					<div class="position-absolute text-secondary py-1 px-2 mdi mdi-18px"
						:class="{ 'mdi-eye-outline': !showPassRepeat, 'mdi-eye-off-outline': showPassRepeat }"
						@click="showPassRepeat = !showPassRepeat" role="button"
						style="top: 0px; right: -30px">
					</div>
				</b-form-group>
				
				<div class="d-flex flex-column">
					<b-button type="submit" variant="primary">{{ $t('password.recover.changePassword') }}</b-button>
					<b-button type="reset" @click="onReset()" variant="link">{{ $t('password.recover.cancel') }}</b-button>
				</div>
			</b-form>
			
			<b-popover v-if="$root.config.admin.passwordPolicyEnabled"
				:target="() => $refs.passwordHelper" triggers="click"
				placement="right">
				<h6>{{ $t('password.policy.title') }}</h6>
				<div>{{ $t('password.policy.header') }}</div>
				<ul>
					<li v-for="item in $t('password.policy.items')">{{ item }}</li>
				</ul>
			</b-popover>

			<footer class="fixed-bottom text-center text-muted">CIB flow &copy CIB, {{ new Date().getFullYear() }}</footer>
		</div>
		
		<success ref="emailSent"> {{ $t('password.recover.emailSent') }} </success>
	</div>
	
	<b-modal ref="passwordModal" centered>
		<template #modal-title>{{ $t('password.recover.title') }}</template>
		
		<b-form @submit.prevent="onSendEmail()"> 
			<b-form-group labels-cols-sm="12" label-size="lg" label-class="font-weight-bold px-6" class="m-0">
				<b-form-group :label="$t('password.recover.id') + '*'" :invalid-feedback="$t('errors.invalid')"> 
					<b-form-input v-model="profile.id" :state="notEmpty(profile.id)" required></b-form-input>
				</b-form-group>
			</b-form-group> 
		</b-form>
		
		<template #modal-footer>
			<b-spinner variant="primary" v-if="sendingEmail"></b-spinner>
			<b-button type="submit" variant="secondary" :disabled="sendingEmail"
				@click="onSendEmail()">{{ $t('password.recover.sendEmail') }}</b-button>
		</template>
	</b-modal>
	
	<b-modal centered hide-footer ref="emailInfo" header-class="border-0 p-0" body-class="p-0" class="my-2">
		<template #modal-header>
			<h5 class="m-auto">{{ $t('password.emailInfo.title') }}</h5>
			<button type="button" aria-label="Close" class="close m-0"
				@click.prevent="$refs.emailInfo.hide()">Ã—</button>
		</template>
		<div class="text-center p-4 px-5">
			<img src="webjars/seven/components/password/mail.svg" alt="Email Sent"
				class="img-fluid mb-3" style="width: 150px;">
			<h6>{{ $t('password.emailInfo.header') }}</h6>
			<p>{{ $t('password.emailInfo.body') }}</p>
		</div>
		
		<div class="text-center bg-light p-4 px-5">
			<h6>{{ $t('password.emailInfo.footerTitle') }}</h6>
			<h6>{{ $t('password.emailInfo.footerBody') }}</h6>
			<b-button variant="secondary" class="mb-3" @click="resendEmail()">{{ $t('password.emailInfo.sendMail') }}</b-button>
			<br>
			<p>{{ $t('password.emailInfo.support') }}</p>
			<b-link href="#" @click.prevent="$refs.support.show()">{{ $t('password.emailInfo.supportLink') }}</b-link>
		</div>
	</b-modal>
	
	<success style="z-index: 2000" ref="emailSent"> {{ $t('password.recover.emailSent') }} </success>
	<support-modal ref="support"></support-modal>
	
</div>

