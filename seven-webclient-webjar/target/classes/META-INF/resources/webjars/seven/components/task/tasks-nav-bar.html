<div v-show="showTasks" class="overflow-auto h-100">
	<div class="h-100 d-flex flex-column border border-end-0 border-top-0 bg-light">
		
		<b-button style="top: 3px; right: 30px" class="border-0 position-absolute" v-if="$root.config.layout.showTaskListManualRefresh" 
			variant="btn-outline-primary" size="sm" :disabled="pauseRefreshButton" :title="$t('nav-bar.refresh')" @click="$emit('refresh-tasks'); pauseButton()">
			<span class="visually-hidden">{{ $t('nav-bar.refresh') }}</span>
			<span class="mdi mdi-18px mdi-refresh"></span>
		</b-button>
		
		<div class="py-1 px-2 mb-1 bg-task-filter">
			<smart-search class="m-1 mb-2" :maxlength="50" :options="$root.config.taskFilter.smartSearch.options" 
				@input="$emit('search-filter', $event)" @open-advanced-search="$refs.advancedSearchModal.show()"></smart-search>
			<hr class="my-0">
			<div class="row g-0 d-flex align-items-center">
				<b-form-group class="mb-0 col-auto">
					<b-input-group size="sm" class="align-items-center">
					  	<b-dropdown ref="sortingList" size="sm" variant="link" class="me-1" toggle-class="text-decoration-none" :title="$t('sorting.sortBy')" no-caret>
					    	<template #button-content>
						     	<i v-hover-style="{ classes: ['text-primary'] }" class="mdi mdi-18px mdi-filter-variant"></i><span class="visually-hidden">{{ $t('sorting.sortBy') }}</span>
						    </template>
						    <b-dd-item-btn v-for="item in filteredFields" :key="item" @click="taskSorting.sortBy = item; setSorting('key')">
						  		{{ $t('sorting.' + item) }}
							</b-dd-item-btn>
					  	</b-dropdown>
					  	<b-button variant="link" class="text-decoration-none px-0" @click="$refs.sortingList.show()">{{ $t('sorting.' + taskSorting.sortBy) }}</b-button>
						<template v-slot:append>
							<b-button size="sm" v-hover-style="{ classes: ['text-primary'] }" variant="secondary-outline" @click="setSorting('order')" class="mdi mdi-18px ms-1" 
								:class="taskSorting.sortOrder === 'desc' ? 'mdi-arrow-down' : 'mdi-arrow-up'" 
								:title="taskSorting.sortOrder === 'desc' ? $t('sorting.desc') : $t('sorting.asc')">
								<span v-if="taskSorting.sortOrder === 'desc'" class="visually-hidden">{{ $t('sorting.desc') }}</span>
								<span v-else class="visually-hidden">{{ $t('sorting.asc') }}</span>
							</b-button>
						</template>
					</b-input-group>
				</b-form-group>
				<div v-if="$root.config.layout.showFilterReminderDate || $root.config.layout.showFilterDueDate ||
					($root.config.taskFilter.advancedSearch.processVariables.length > 0 && $root.config.taskFilter.advancedSearch.filterEnabled)" class="ms-auto col-auto">
					<b-button ref="filters" v-hover-style="{ classes: ['text-primary'] }" variant="link" :title="$t('nav-bar.filtersAdditionalsTitle')">
						<span class="mdi mdi-18px" 
							:class="$store.state.filter.settings.reminder || $store.state.filter.settings.dueDate || $store.state.advancedSearch.criterias.length > 0 ? 'mdi-filter-menu text-primary' : 'mdi-filter-menu-outline'"></span>
					</b-button>
				</div>
			</div>
		</div>
		<b-popover :target="function() { return $refs.filters }" placement="bottom" triggers="click blur" @show="loadAdvancedFilters">
			<div><h5 class="mt-3">{{ $t('task.showOnlyAddFilters') }}</h5></div>
			<hr class="my-2">
			<div class="mt-2">
			    <b-form-checkbox v-if="$root.config.layout.showFilterReminderDate" v-model="$store.state.filter.settings.reminder">
			    	<h5 class="d-flex fw-normal"><span class="mdi mdi-16px mdi-alarm align-middle pe-1"></span> {{ $t('nav-bar.reminder') }}</h5>
			    </b-form-checkbox>
			</div>
			<div>
			    <b-form-checkbox v-if="$root.config.layout.showFilterDueDate" v-model="$store.state.filter.settings.dueDate">
		      		<h5 class="d-flex fw-normal"><span class="mdi mdi-16px mdi-calendar-alert align-middle pe-1"></span> {{ $t('nav-bar.dueDate') }}</h5>
			    </b-form-checkbox>
			</div>			
			<div v-if="$root.config.taskFilter.advancedSearch.filterEnabled" v-for="criteria in advancedFilter">
				<b-form-checkbox v-model="criteria.check">
					<h5 class="d-flex fw-normal">{{ criteria.displayName }}</h5>
				</b-form-checkbox>
				<b-form-input v-if="criteria.check && criteria.defaultValue === ''" v-model="criteria.value" size="sm" class="mb-2"></b-form-input>
			</div>
		</b-popover>
		<!-- <camunda-filter @filter-alert="$emit('filter-alert', $event)" class="mx-1 my-0 py-2" @display-popover="$emit('display-popover', $event)" @set-filter="$emit('set-filter', $event)"></camunda-filter> -->	
		<div class="overflow-auto flex-fill border-bottom" @scroll="handleScrollTasks">
			<div v-if="tasksFiltered.length > 0">
				<b-list-group class="mx-3">
					<b-list-group-item @click="selectedTask(task)" v-for="task of tasksFiltered" :key="task.id" @mouseenter="focused = task" @mouseleave="focused = null"
					class="rounded-0 mt-3 p-2 bg-white border-0" :class="task.id === $route.params.taskId ? 'active shadow' : ''" draggable="false" 
					tabindex=0 style="cursor: pointer" v-on:keyup.enter="selectedTask(task)" action>
						<div class="d-flex align-items-center">
							<h6 style="max-width: 100%; font-size: 1rem">
								<span class="fw-bold">{{ task.name }}</span>
							</h6>
							<div class="d-flex ms-auto">
								<b-button @click="$refs['followUp' + task.id][0].show()" v-if="$root.config.layout.showFilterReminderDate" size="sm" :class="getReminderClasses(task)" variant="outline-secondary" class="mdi mdi-18px mdi-alarm border-0" :title="getDateFormatted(task.followUp, 'L', 'setReminder')"></b-button>
								<b-button @click="$refs['due' + task.id][0].show()" v-if="$root.config.layout.showFilterDueDate" size="sm" :class="getDueClasses(task)" variant="outline-secondary" class="mdi mdi-18px mdi-calendar-alert ms-2 border-0" :title="getDateFormatted(task.due, 'L', 'setDeadline')"></b-button>
							</div>
						</div>
						<div v-if="task.businessKey && $root.config.layout.showBusinessKey" class="d-flex align-items-center mb-1">
							<span :title="$t(task.businessKey)">{{ task.businessKey }}</span><br>
						</div>							
						<div v-if="getProcessName(task.processDefinitionId)" class="fw-normal h5">
							{{ getProcessName(task.processDefinitionId) }}
						</div>
						<div class="d-flex align-items-center">
	<!-- 						<span class="mdi mdi-18px mdi-calendar-month mdi-dark"></span> -->
							<div class="h6 fw-normal m-0" :title="getDateFormatted(task.createdOriginal, 'L LTS')">{{ getDateFormatted(task.createdOriginal) }}</div><br>
							<div class="d-flex ms-auto">
								<div class="h6 text-end p-0 fw-normal m-0" v-if="task.assignee != null"><span class="mdi mdi-18px mdi-account text-secondary"></span><span class="p-1">{{ getCompleteName(task) }}</span></div>
								<div class="h6 text-end p-0 fw-normal n-0" v-if="task.assignee == null">
									<b-button variant="link" class="p-0 text-dark" @click.stop="checkAssignee(task)"><span class="mdi mdi-18px mdi-account-question text-secondary"></span> {{ $t('task.assignToMe') }}</b-button>
								</div>
							</div>								
						</div>
						<b-modal :ref="'followUp' + task.id" @show="copyTaskForDateManagement(task, 'followUp')" @hide="selectedDateT = {}">
				    		<b-calendar @input="setTime(null, 'followUp')" v-model="selectedDateT.followUp" value-as-date :start-weekday="1" :locale="currentLanguage()" block
				    		:label-no-date-selected="$t('cib-datepicker2.noDate')" :date-format-options="{ year: 'numeric', month: '2-digit', day: '2-digit' }"
				    		:label-reset-button="$t('cib-datepicker2.reset')" :label-today-button="$t('cib-datepicker2.today')" :date-disabled-fn="isInThePast" label-help="">
			    				<div class="d-flex">
				    				<b-button size="sm" variant="outline-primary"  @click="selectedDateT.followUp = new Date();">
								        {{ $t('cib-datepicker2.today') }}
							      	</b-button>
							      	<b-button size="sm" variant="outline-danger" class="ms-auto" @click="selectedDateT.followUp = null">
							        	{{ $t('cib-datepicker2.reset') }}
							      	</b-button>
			    				</div>
				    		</b-calendar>
				    		<template v-slot:modal-footer>
								<b-button @click="$refs['followUp' + task.id][0].hide()" class="text-secondary" variant="link">{{ $t('confirm.cancel') }}</b-button>
						   		<b-button @click="setDate(task, 'followUp')" variant="primary">{{ $t('task.setReminder') }}</b-button>
							</template>
					  	</b-modal>
					  	<b-modal :ref="'due' + task.id" @show="copyTaskForDateManagement(task, 'due')" @hide="selectedDateT = {}">
							<b-calendar @input="setTime(selectedDateT.dueTime, 'due')" v-model="selectedDateT.due" value-as-date :start-weekday="1" :locale="currentLanguage()" block
							:label-no-date-selected="$t('cib-datepicker2.noDate')" :date-format-options="{ year: 'numeric', month: '2-digit', day: '2-digit' }"
							:label-reset-button="$t('cib-datepicker2.reset')" :label-today-button="$t('cib-datepicker2.today')" label-help="">
								<div class="d-flex">
									<b-button size="sm" variant="outline-primary" @click="selectedDateT.due = new Date(); setTime(selectedDateT.dueTime, 'due')">
										{{ $t('cib-datepicker2.today') }}
									</b-button>
									<b-button size="sm" variant="outline-danger" class="ms-auto" @click="selectedDateT.due = null">
										{{ $t('cib-datepicker2.reset') }}
									</b-button>
								</div>
							</b-calendar>
							<hr>
							<b-form-timepicker v-model="selectedDateT.dueTime" @input="setTime($event, 'due')" no-close-button :label-no-time-selected="$t('cib-timepicker.noDate')"
								reset-button class="flex-fill" reset-value="23:59:00" :label-reset-button="$t('cib-timepicker.reset')" :locale="currentLanguage()"></b-form-timepicker>
							<template v-slot:modal-footer>
								<b-button :title="$t('confirm.cancel')" @click="$refs['due' + task.id][0].hide()" class="text-secondary" variant="link">{{ $t('confirm.cancel') }}</b-button>
						   		<b-button :title="$t('task.setDeadline')" @click="setDate(task, 'due')" variant="primary">{{ $t('task.setDeadline') }}</b-button>
							</template>
						</b-modal>
					</b-list-group-item>
				</b-list-group>
<!-- 				<div v-if="tasksFiltered.length >= taskResultsIndex" class="text-center mt-3"> -->
<!-- 					<b-button variant="outline-secondary" @click="$emit('show-more')"> -->
<!-- 						{{ $t('task.showMore') }} -->
<!-- 					</b-button> -->
<!-- 				</div> -->
			</div>
			<loader v-show="tasksFiltered.length < 1" ref="taskLoader" class="d-flex justify-content-center pt-4" styling="width:30%">
				<div v-if="tasksFiltered.length < 1 && $store.state.filter.selected.name === 'default'">
					<img :alt="$t('nav-bar.no-tasks-pending')" src="webjars/seven/components/task/no_tasks_pending.svg" class="d-block mx-auto mt-3 mb-2" style="width: 200px">		
					<div class="h5 text-secondary text-center">{{ $t('nav-bar.no-tasks-pending') }}</div>
				</div>
				<div v-if="tasksFiltered.length < 1 && $store.state.filter.selected.name !== 'default'">
					<img :alt="$t('nav-bar.no-tasks')" src="components/task/no_tasks.svg" class="d-block mx-auto mt-3 mb-2" style="width: 200px">		
					<div class="h5 text-secondary text-center">{{ $t('nav-bar.no-tasks') }}</div>
				</div>
			</loader>
		</div>
		<start-process v-show="false" ref="startProcess" :processes="$store.state.process.list" @display-popover="$emit('display-popover', $event)"
		@process-started="$emit('process-started', $event)"></start-process>
		<advanced-search-modal v-if="$root.config.taskFilter.advancedSearch.modalEnabled" ref="advancedSearchModal" @refresh-tasks="$emit('refresh-tasks')"></advanced-search-modal>
	</div>
	<confirm ref="confirmTaskAssign" @ok="claim($event)">
		<span>{{ $t('confirm.assignUser') }}</span>
	</confirm>
</div>
